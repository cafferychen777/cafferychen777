<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chen Yang (Caffery) - 3D GitHub Contributions</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #0d1117; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }
        canvas { display: block; }
        #info {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            color: white;
            padding: 5px;
            font-size: 14px;
        }
        h1 {
            color: white;
            font-size: 24px;
            margin-bottom: 5px;
        }
        p {
            margin: 5px 0;
        }
        a {
            color: #58a6ff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
        }
        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background-color: rgba(13, 17, 23, 0.8);
            padding: 10px;
            border-radius: 5px;
            color: white;
            font-size: 12px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .legend-color {
            width: 15px;
            height: 15px;
            margin-right: 10px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div id="info">
        <h1>Chen Yang (Caffery) - 3D GitHub Contributions</h1>
        <p>Drag to rotate | Scroll to zoom | Right-click to pan</p>
        <p><a href="https://github.com/cafferychen777" target="_blank">Visit My GitHub Profile</a></p>
    </div>
    <div id="loading">Loading contributions data...</div>
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background-color: #0e4429;"></div>
            <span>10+ contributions</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #006d32;"></div>
            <span>5-9 contributions</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #26a641;"></div>
            <span>2-4 contributions</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #39d353;"></div>
            <span>1 contribution</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #161b22;"></div>
            <span>No contributions</span>
        </div>
    </div>

    <script>
        // 场景、相机和渲染器设置
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0d1117);
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 20, 30);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        
        // 添加轨道控制
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        
        // 添加环境光和方向光
        const ambientLight = new THREE.AmbientLight(0x404040, 1);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(1, 1, 1);
        scene.add(directionalLight);
        
        // 贡献颜色映射 - 使用更明亮的颜色
        const contributionColors = {
            0: 0x2d333b, // 无贡献 - 稍微亮一些
            1: 0x39d353, // 1次贡献
            2: 0x26a641, // 2-4次贡献
            3: 0x006d32, // 5-9次贡献
            4: 0x0e4429  // 10+次贡献
        };
        
        // 获取GitHub贡献数据
        async function fetchContributions() {
            const username = 'cafferychen777';
            const loadingElement = document.getElementById('loading');
            
            try {
                // 尝试使用GitHub API获取贡献数据
                loadingElement.textContent = 'Fetching contribution data...';
                
                // 注意：这个API可能不可靠，所以我们设置超时
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                
                const response = await fetch(`https://github-contributions-api.jogruber.de/v4/${username}`, {
                    signal: controller.signal
                }).catch(e => {
                    console.error('Fetch error:', e);
                    return null;
                });
                
                clearTimeout(timeoutId);
                
                if (response && response.ok) {
                    const data = await response.json();
                    
                    if (data && data.contributions && data.contributions.length > 0) {
                        loadingElement.style.display = 'none';
                        createContributionGraph(data.contributions);
                        return; // 成功获取数据，提前返回
                    }
                }
                
                // 如果到达这里，说明API调用失败或数据无效
                throw new Error('Invalid data format or empty contributions');
                
            } catch (error) {
                console.error('Error fetching contributions:', error);
                loadingElement.textContent = 'Using sample contribution data...';
                
                // 使用示例数据
                setTimeout(() => {
                    loadingElement.style.display = 'none';
                    createSampleContributionGraph();
                }, 1000);
            }
        }
        
        // 创建贡献图
        function createContributionGraph(contributions) {
            const weeks = contributions.length;
            const days = 7;
            
            // 创建一个组来包含所有立方体
            const contributionGroup = new THREE.Group();
            scene.add(contributionGroup);
            
            // 遍历贡献数据创建立方体
            for (let week = 0; week < weeks; week++) {
                for (let day = 0; day < days; day++) {
                    if (week < contributions.length && day < contributions[week].length) {
                        const contribution = contributions[week][day];
                        
                        // 根据贡献数量确定颜色和高度
                        let colorLevel = 0;
                        let height = 0.2;
                        
                        if (contribution.count > 0) {
                            if (contribution.count >= 10) {
                                colorLevel = 4;
                                height = 2;
                            } else if (contribution.count >= 5) {
                                colorLevel = 3;
                                height = 1.5;
                            } else if (contribution.count >= 2) {
                                colorLevel = 2;
                                height = 1;
                            } else {
                                colorLevel = 1;
                                height = 0.5;
                            }
                        }
                        
                        // 创建立方体几何体和材质
                        const geometry = new THREE.BoxGeometry(0.9, height, 0.9);
                        const material = new THREE.MeshLambertMaterial({ 
                            color: contributionColors[colorLevel],
                            transparent: true,
                            opacity: 0.9
                        });
                        
                        // 创建立方体网格
                        const cube = new THREE.Mesh(geometry, material);
                        
                        // 设置立方体位置
                        cube.position.x = week - weeks / 2;
                        cube.position.y = height / 2;
                        cube.position.z = day - days / 2;
                        
                        // 将立方体添加到组中
                        contributionGroup.add(cube);
                        
                        // 添加悬停效果的数据
                        cube.userData = {
                            date: contribution.date,
                            count: contribution.count
                        };
                    }
                }
            }
            
            // 调整相机位置以适应贡献图
            const offset = Math.max(weeks, days) * 0.6;
            camera.position.set(0, offset, offset * 1.5);
            controls.update();
        }
        
        // 创建示例贡献图（当API调用失败时使用）
        function createSampleContributionGraph() {
            const weeks = 52;
            const days = 7;
            
            // 创建一个组来包含所有立方体
            const contributionGroup = new THREE.Group();
            scene.add(contributionGroup);
            
            // 创建一个更有模式的示例数据，而不是完全随机
            // 这样可以更好地模拟真实的贡献模式
            for (let week = 0; week < weeks; week++) {
                for (let day = 0; day < days; day++) {
                    // 创建一些模式 - 周末贡献更多，某些周期性模式
                    let count = 0;
                    
                    // 周末（周六和周日）贡献更多
                    if (day >= 5) {
                        count = Math.floor(Math.random() * 10) + 1;
                    } 
                    // 每月的第一周贡献更多
                    else if (week % 4 === 0) {
                        count = Math.floor(Math.random() * 8);
                    }
                    // 每季度有一个高峰期
                    else if (week % 12 === 6) {
                        count = Math.floor(Math.random() * 12) + 3;
                    }
                    // 其他时间随机贡献
                    else {
                        // 70%的概率有贡献
                        if (Math.random() > 0.3) {
                            count = Math.floor(Math.random() * 5);
                        }
                    }
                    
                    // 根据贡献数量确定颜色和高度
                    let colorLevel = 0;
                    let height = 0.2;
                    
                    if (count > 0) {
                        if (count >= 10) {
                            colorLevel = 4;
                            height = 2;
                        } else if (count >= 5) {
                            colorLevel = 3;
                            height = 1.5;
                        } else if (count >= 2) {
                            colorLevel = 2;
                            height = 1;
                        } else {
                            colorLevel = 1;
                            height = 0.5;
                        }
                    }
                    
                    // 创建立方体几何体和材质
                    const geometry = new THREE.BoxGeometry(0.9, height, 0.9);
                    const material = new THREE.MeshLambertMaterial({ 
                        color: contributionColors[colorLevel],
                        transparent: true,
                        opacity: 0.9
                    });
                    
                    // 创建立方体网格
                    const cube = new THREE.Mesh(geometry, material);
                    
                    // 设置立方体位置
                    cube.position.x = week - weeks / 2;
                    cube.position.y = height / 2;
                    cube.position.z = day - days / 2;
                    
                    // 将立方体添加到组中
                    contributionGroup.add(cube);
                }
            }
            
            // 调整相机位置以适应贡献图
            const offset = Math.max(weeks, days) * 0.6;
            camera.position.set(0, offset, offset * 1.5);
            controls.update();
        }
        
        // 窗口大小调整处理
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        window.addEventListener('resize', onWindowResize, false);
        
        // 动画循环
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        
        // 启动应用
        fetchContributions();
        animate();
    </script>
</body>
</html>
